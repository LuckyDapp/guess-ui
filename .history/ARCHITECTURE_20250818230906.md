# Document d'Architecture - DApp "Guess The Number"

## 1. Vue d'ensemble

### 1.1 Description du projet
La DApp "Guess The Number" est une application décentralisée basée sur Polkadot qui permet aux utilisateurs de jouer à un jeu de devinettes de nombres. L'application utilise des smart contracts ink! déployés sur Pop Network et offre une interface utilisateur moderne construite avec React et Material-UI.

### 1.2 Architecture générale
L'application suit une architecture moderne de DApp avec :
- **Frontend** : Application React avec TypeScript
- **Blockchain** : Pop Network (parachain Polkadot)
- **Smart Contracts** : Contrats ink! v6.0.0-alpha
- **Wallet Integration** : Support multi-wallets via dot-connect
- **State Management** : Context API React + Reactive Dot

## 2. Architecture Technique

### 2.1 Stack Technologique

#### Frontend
- **Framework** : React 19+ avec TypeScript
- **UI Library** : Material-UI (MUI) v7.2.0
- **Build Tool** : Vite
- **State Management** : React Context API + Reactive Dot
- **Styling** : Emotion + CSS Modules

#### Blockchain Integration
- **Network** : Pop Network (wss://rpc1.paseo.popnetwork.xyz)
- **Smart Contract Language** : ink! v6.0.0-alpha
- **API Client** : Polkadot API v1.16.1
- **Contract SDK** : @polkadot-api/sdk-ink v0.1.0
- **Wallet Integration** : dot-connect v0.20.0

#### Development Tools
- **Package Manager** : Yarn
- **Type Checking** : TypeScript
- **Code Generation** : papi (Polkadot API CLI)
- **Error Handling** : React Error Boundary

### 2.2 Structure des Dossiers

```
guess-the-number-ui/
├── src/
│   ├── components/          # Composants React
│   │   ├── app.tsx         # Composant racine
│   │   ├── game.tsx        # Logique du jeu
│   │   ├── game-intro.tsx  # Introduction du jeu
│   │   └── account-select.tsx # Sélection de compte
│   ├── contexts/           # Contextes React
│   │   └── game-context.tsx # État global du jeu
│   ├── utils/              # Utilitaires
│   │   └── number-utils.ts # Validation des nombres
│   ├── styles/             # Styles CSS
│   ├── config.ts           # Configuration de l'app
│   ├── contract.tsx        # Interface avec les smart contracts
│   ├── types.ts            # Types TypeScript
│   ├── theme.ts            # Thème Material-UI
│   └── main.tsx            # Point d'entrée
├── metadata/               # Métadonnées des smart contracts
├── .papi/                  # Fichiers générés par papi
├── package.json            # Dépendances et scripts
└── index.html              # Template HTML
```

## 3. Architecture des Composants

### 3.1 Hiérarchie des Composants

```
App
├── ReactiveDotProvider
├── ConnectionButton
├── ChainProvider
│   └── AccountSelect
│       └── SignerProvider
│           └── GameContextProvider
│               └── Game
│                   ├── GameIntro
│                   ├── CurrentGame
│                   │   └── MakeGuess
│                   └── NewGame
└── Toaster
```

### 3.2 Responsabilités des Composants

#### App.tsx
- **Rôle** : Point d'entrée principal de l'application
- **Responsabilités** :
  - Configuration des providers (ReactiveDot, Chain, Signer)
  - Gestion de la connexion wallet
  - Gestion des erreurs globales
  - Configuration des notifications toast

#### Game.tsx
- **Rôle** : Composant principal du jeu
- **Responsabilités** :
  - Affichage de l'interface du jeu
  - Gestion des erreurs avec ErrorBoundary
  - Orchestration des sous-composants

#### GameContext.tsx
- **Rôle** : Gestion de l'état global du jeu
- **Responsabilités** :
  - Synchronisation avec le smart contract
  - Gestion des tentatives de jeu
  - Rafraîchissement automatique des données
  - Cache local des données

## 4. Architecture des Smart Contracts

### 4.1 Structure du Contrat

Le smart contract `guess_the_number` implémente les fonctionnalités suivantes :

#### Messages (Fonctions)
1. **`start_new_game(min_number, max_number)`**
   - Crée une nouvelle partie
   - Génère un nombre aléatoire via VRF
   - Initialise l'état du jeu

2. **`guess(guess)`**
   - Permet de faire une tentative
   - Retourne un indice (Plus/Moins/Trouvé)
   - Met à jour l'état du jeu

3. **`get_current_game()`**
   - Récupère l'état actuel du jeu
   - Retourne les informations de la partie en cours

#### Événements
- **`GameStarted`** : Émis lors du démarrage d'une nouvelle partie
- **`GuessMade`** : Émis lors d'une tentative

### 4.2 Intégration Contract-Frontend

#### Contract.tsx
- **Rôle** : Interface entre le frontend et les smart contracts
- **Fonctionnalités** :
  - Création et gestion des instances de contrat
  - Exécution des transactions (dry-run + submit)
  - Gestion des événements de transaction
  - Intégration avec les notifications toast

#### Méthodes principales :
- `getCurrentGame()` : Récupération de l'état du jeu
- `makeAGuess()` : Soumission d'une tentative
- `startNewGame()` : Démarrage d'une nouvelle partie

## 5. Gestion de l'État

### 5.1 État Global (GameContext)

```typescript
type GameContextStruct = {
    game: Game | undefined,
    getAttempts: () => Attempt[],
    refreshGuesses: () => void,
    refreshGame: () => void,
}
```

### 5.2 Types de Données

#### Game
```typescript
type Game = {
    game_number: bigint;
    min_number: number;
    max_number: number;
    attempt: number;
    last_guess: number | undefined;
    last_clue: Clue | undefined;
}
```

#### Attempt
```typescript
type Attempt = {
    gameNumber: bigint;
    attemptNumber: number,
    guess: number,
    clue: Clue | unknown,
}
```

### 5.3 Synchronisation des Données

- **Polling automatique** : Rafraîchissement toutes les 10 secondes
- **Cache local** : Stockage des tentatives en mémoire
- **Synchronisation réactive** : Mise à jour lors des transactions

## 6. Gestion des Erreurs

### 6.1 Stratégies d'Erreur

1. **Error Boundary** : Capture des erreurs React
2. **Toast Notifications** : Feedback utilisateur immédiat
3. **Validation côté client** : Vérification des entrées utilisateur
4. **Dry-run** : Test des transactions avant soumission
5. **Retry Mechanism** : Possibilité de réessayer en cas d'échec

### 6.2 Types d'Erreurs Gérées

- **Erreurs de connexion wallet**
- **Erreurs de transaction blockchain**
- **Erreurs de validation des entrées**
- **Erreurs de réseau**
- **Erreurs de smart contract**

## 7. Sécurité

### 7.1 Mesures de Sécurité

1. **Validation des entrées** : Vérification des nombres positifs
2. **Dry-run des transactions** : Test avant soumission
3. **Gestion des erreurs** : Pas d'exposition d'informations sensibles
4. **Wallet integration sécurisée** : Utilisation de dot-connect

### 7.2 Bonnes Pratiques

- Validation côté client ET serveur
- Gestion sécurisée des clés privées (via wallet)
- Logs d'erreur sans données sensibles
- Timeout sur les requêtes réseau

## 8. Performance

### 8.1 Optimisations

1. **Lazy Loading** : Chargement à la demande
2. **Memoization** : Cache des données de jeu
3. **Polling intelligent** : Rafraîchissement conditionnel
4. **Bundle splitting** : Séparation du code

### 8.2 Métriques

- **Temps de chargement initial** : < 3s
- **Temps de réponse des transactions** : < 30s
- **Fréquence de rafraîchissement** : 10s
- **Taille du bundle** : Optimisé via Vite

## 9. Déploiement

### 9.1 Environnements

- **Development** : `yarn dev` (localhost:5173)
- **Production** : `yarn build` + serveur statique
- **Preview** : `yarn serve` (localhost:4173)

### 9.2 Configuration

- **RPC Endpoint** : Configurable via `config.ts`
- **Contract Address** : Configurable par chaîne
- **Wallet Support** : Multi-wallets via dot-connect

## 10. Évolutivité

### 10.1 Extensions Possibles

1. **Multi-chaînes** : Support d'autres parachains
2. **Leaderboards** : Classements des joueurs
3. **Tournois** : Mode compétitif
4. **NFTs** : Récompenses sous forme de tokens
5. **Social Features** : Partage et défis

### 10.2 Architecture Modulaire

- Composants réutilisables
- Contextes séparés par domaine
- Utilitaires génériques
- Configuration externalisée

## 11. Monitoring et Observabilité

### 11.1 Logs

- Logs de connexion wallet
- Logs de transactions
- Logs d'erreurs
- Métriques de performance

### 11.2 Métriques

- Nombre de parties créées
- Nombre de tentatives
- Taux de réussite
- Temps moyen par partie

## 12. Conclusion

L'architecture de la DApp "Guess The Number" suit les meilleures pratiques modernes de développement d'applications décentralisées. Elle offre une base solide pour l'évolution et l'extension des fonctionnalités tout en maintenant une expérience utilisateur fluide et sécurisée.
